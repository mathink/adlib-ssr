<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>Adlibssr.btree_walk</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Adlibssr.btree_walk</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab6"></a><h1 class="section">Binary tree on Coq with SSReflect</h1>

 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Ssreflect.ssreflect</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Ssreflect.ssrfun</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Ssreflect.ssrbool</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Ssreflect.eqtype</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Ssreflect.seq</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Ssreflect.ssrnat</span>.<br/>

<br/>
<span class="id" type="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab7"></a><h2 class="section">Definitions of Type of Binary-tree</h2>

</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">btree</span> (<span class="id" type="var">T</span>: <span class="id" type="keyword">Type</span>) :=<br/>
| <span class="id" type="var">bleaf</span><br/>
| <span class="id" type="var">bnode</span> (<span class="id" type="var">x</span>: <span class="id" type="var">T</span>)(<span class="id" type="var">tl</span> <span class="id" type="var">tr</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span>).<br/>

<br/>
<span class="id" type="keyword">Notation</span> "#" := <span class="id" type="var">bleaf</span>.<br/>
<span class="id" type="keyword">Notation</span> "tl -&lt; x &gt;- tr" := (<span class="id" type="var">bnode</span> <span class="id" type="var">x</span> <span class="id" type="var">tl</span> <span class="id" type="var">tr</span>) (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 65, <span class="id" type="keyword">no</span> <span class="id" type="keyword">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">BinaryTree</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> (<span class="id" type="var">T</span>: <span class="id" type="keyword">Type</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Type</span> (<span class="id" type="var">t</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">size</span> <span class="id" type="var">t</span> : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> (<span class="id" type="var">size</span> <span class="id" type="var">tl</span> + <span class="id" type="var">size</span> <span class="id" type="var">tr</span>).+1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size0bleaf</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">t</span> = 0 -&gt; <span class="id" type="var">t</span> = #.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">bleafSp</span> <span class="id" type="var">t</span> := <span class="id" type="var">size</span> <span class="id" type="var">t</span> == 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bleafSP</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="var">t</span> = #) (<span class="id" type="var">bleafSp</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">height</span> <span class="id" type="var">t</span> : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">let</span> <span class="id" type="var">hl</span> := <span class="id" type="var">height</span> <span class="id" type="var">tl</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">hr</span> := <span class="id" type="var">height</span> <span class="id" type="var">tr</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">maxn</span> <span class="id" type="var">hl</span> <span class="id" type="var">hr</span>).+1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">height0bleaf</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">height</span> <span class="id" type="var">t</span> = 0 -&gt; <span class="id" type="var">t</span> = #.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">bleafHp</span> <span class="id" type="var">t</span> := <span class="id" type="var">height</span> <span class="id" type="var">t</span> == 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bleafHP</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="var">t</span> = #) (<span class="id" type="var">bleafHp</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bleafSH</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">bleafSp</span> <span class="id" type="var">t</span> == <span class="id" type="var">bleafHp</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">revtree</span> <span class="id" type="var">t</span> : <span class="id" type="var">btree</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">revtree</span> <span class="id" type="var">tr</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">revtree</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> #.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">revtree_idempotent</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">revtree</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) = <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">revtree_size</span> <span class="id" type="var">t</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">size</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) = <span class="id" type="var">size</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">revtree_height</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">height</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) = <span class="id" type="var">height</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>: <span class="id" type="var">seq</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">walk</span> <span class="id" type="var">tl</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">walk</span> <span class="id" type="var">tr</span> <span class="id" type="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">s</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">flatten</span> <span class="id" type="var">t</span> := <span class="id" type="var">walk</span> <span class="id" type="var">t</span> [::].<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_size</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.size</span> (<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) = <span class="id" type="var">size</span> <span class="id" type="var">t</span> + <span class="id" type="var">seq.size</span> <span class="id" type="var">s</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_size</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.size</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) = <span class="id" type="var">size</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_cat</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> ++ <span class="id" type="var">s2</span> = <span class="id" type="var">walk</span> <span class="id" type="var">t</span> (<span class="id" type="var">s1</span> ++ <span class="id" type="var">s2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_rev</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rev</span> (<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) = <span class="id" type="var">rev</span> <span class="id" type="var">s</span> ++ <span class="id" type="var">walk</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) [::].<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_rev</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rev</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) = <span class="id" type="var">flatten</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">walk_m</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>: <span class="id" type="var">seq</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">walk_m</span> <span class="id" type="var">tr</span> (<span class="id" type="var">walk_m</span> <span class="id" type="var">tl</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">s</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">flatten_m</span> <span class="id" type="var">t</span> := <span class="id" type="var">walk_m</span> <span class="id" type="var">t</span> [::].<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">walk_r</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>: <span class="id" type="var">seq</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">walk_r</span> <span class="id" type="var">tl</span> (<span class="id" type="var">rcons</span> (<span class="id" type="var">walk_r</span> <span class="id" type="var">tr</span> <span class="id" type="var">s</span>) <span class="id" type="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">s</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">flatten_r</span> <span class="id" type="var">t</span> := <span class="id" type="var">walk_r</span> <span class="id" type="var">t</span> [::].<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">flatten_l</span> := <span class="id" type="var">flatten</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_r_cat</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">s1</span> ++ <span class="id" type="var">walk_r</span> <span class="id" type="var">t</span> <span class="id" type="var">s2</span> = <span class="id" type="var">walk_r</span> <span class="id" type="var">t</span> (<span class="id" type="var">s1</span> ++ <span class="id" type="var">s2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_lr</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rev</span> (<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) = <span class="id" type="var">walk_r</span> <span class="id" type="var">t</span> (<span class="id" type="var">rev</span> <span class="id" type="var">s</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_lr</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rev</span> (<span class="id" type="var">flatten_l</span> <span class="id" type="var">t</span>) = <span class="id" type="var">flatten_r</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Section</span> <span class="id" type="var">BtreePred</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> (<span class="id" type="var">p</span>: <span class="id" type="var">pred</span> <span class="id" type="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">count</span> <span class="id" type="var">t</span>: <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">let</span>: <span class="id" type="var">cl</span> := <span class="id" type="var">count</span> <span class="id" type="var">tl</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span>: <span class="id" type="var">cr</span> := <span class="id" type="var">count</span> <span class="id" type="var">tr</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">x</span> + <span class="id" type="var">cl</span> + <span class="id" type="var">cr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> 0.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_count</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.count</span> <span class="id" type="var">p</span> (<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) = <span class="id" type="var">seq.count</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> + <span class="id" type="var">count</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_count</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.count</span> <span class="id" type="var">p</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) = <span class="id" type="var">count</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">has</span> <span class="id" type="var">t</span>: <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">p</span> <span class="id" type="var">x</span> || <span class="id" type="var">has</span> <span class="id" type="var">tl</span> || <span class="id" type="var">has</span> <span class="id" type="var">tr</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">false</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_has</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.has</span> <span class="id" type="var">p</span> (<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) = <span class="id" type="var">seq.has</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> || <span class="id" type="var">has</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_has</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.has</span> <span class="id" type="var">p</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) = <span class="id" type="var">has</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">has_bleaf</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">has</span> # = <span class="id" type="var">false</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">has_bnode1</span> <span class="id" type="var">x</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">has</span> (#-&lt; <span class="id" type="var">x</span> &gt;-#) = <span class="id" type="var">p</span> <span class="id" type="var">x</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">all</span> <span class="id" type="var">t</span>: <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">p</span> <span class="id" type="var">x</span> &amp;&amp; <span class="id" type="var">all</span> <span class="id" type="var">tl</span> &amp;&amp; <span class="id" type="var">all</span> <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">true</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">walk_all</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.all</span> <span class="id" type="var">p</span> (<span class="id" type="var">walk</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) = <span class="id" type="var">seq.all</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> &amp;&amp; <span class="id" type="var">all</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_all</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">seq.all</span> <span class="id" type="var">p</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) = <span class="id" type="var">all</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">all_bleaf</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">all</span> # = <span class="id" type="var">true</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">all_bnode1</span> <span class="id" type="var">x</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">all</span> (#-&lt; <span class="id" type="var">x</span> &gt;-#) = <span class="id" type="var">p</span> <span class="id" type="var">x</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">has_count</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">has</span> <span class="id" type="var">t</span> = (0 &lt; <span class="id" type="var">count</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">count_size</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">count</span> <span class="id" type="var">t</span> &lt;= <span class="id" type="var">size</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">leq_add_eq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">m1</span> &lt;= <span class="id" type="var">n1</span> -&gt; <span class="id" type="var">m2</span> &lt;= <span class="id" type="var">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">m1</span> == <span class="id" type="var">n1</span>) &amp;&amp; (<span class="id" type="var">m2</span> == <span class="id" type="var">n2</span>) = (<span class="id" type="var">m1</span> + <span class="id" type="var">m2</span> == <span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">all_count</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">all</span> <span class="id" type="var">t</span> = (<span class="id" type="var">count</span> <span class="id" type="var">t</span> == <span class="id" type="var">size</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">End</span> <span class="id" type="var">BtreePred</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_count</span> <span class="id" type="var">p1</span> <span class="id" type="var">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p1</span> =1 <span class="id" type="var">p2</span> -&gt; <span class="id" type="var">count</span> <span class="id" type="var">p1</span> =1 <span class="id" type="var">count</span> <span class="id" type="var">p2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_has</span> <span class="id" type="var">p1</span> <span class="id" type="var">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p1</span> =1 <span class="id" type="var">p2</span> -&gt; <span class="id" type="var">has</span> <span class="id" type="var">p1</span> =1 <span class="id" type="var">has</span> <span class="id" type="var">p2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_all</span> <span class="id" type="var">p1</span> <span class="id" type="var">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p1</span> =1 <span class="id" type="var">p2</span> -&gt; <span class="id" type="var">all</span> <span class="id" type="var">p1</span> =1 <span class="id" type="var">all</span> <span class="id" type="var">p2</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Inductive</span> <span class="id" type="var">path</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">path_here</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">path_left</span> <span class="id" type="var">of</span> <span class="id" type="var">path</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">path_right</span> <span class="id" type="var">of</span> <span class="id" type="var">path</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> "&gt;&lt;" := <span class="id" type="var">path_here</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> "&lt;&lt; p" := (<span class="id" type="var">path_left</span> <span class="id" type="var">p</span>) (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 45, <span class="id" type="tactic">right</span> <span class="id" type="keyword">associativity</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> "&gt;&gt; p" := (<span class="id" type="var">path_right</span> <span class="id" type="var">p</span>) (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 45, <span class="id" type="tactic">right</span> <span class="id" type="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Type</span> (<span class="id" type="var">p</span>: <span class="id" type="var">path</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">length</span> <span class="id" type="var">p</span>: <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &gt;&lt; =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;&lt; <span class="id" type="var">p'</span> | &gt;&gt; <span class="id" type="var">p'</span> =&gt; (<span class="id" type="var">length</span> <span class="id" type="var">p'</span>).+1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">traverse</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>: <span class="id" type="var">option</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &gt;&lt; =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;&lt; <span class="id" type="var">p'</span> =&gt; <span class="id" type="var">traverse</span> <span class="id" type="var">p'</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &gt;&gt; <span class="id" type="var">p'</span> =&gt; <span class="id" type="var">traverse</span> <span class="id" type="var">p'</span> <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">None</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">traverse_height</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">height</span> <span class="id" type="var">t</span> &lt; <span class="id" type="var">length</span> <span class="id" type="var">p</span> -&gt; <span class="id" type="var">traverse</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> = <span class="id" type="var">None</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">BinaryTree</span>.<br/>

<br/>

<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

<a name="lab8"></a><h2 class="section">Constructing Instanse of <span class="inlinecode"><span class="id" type="var">eqtype</span></span> for <span class="inlinecode"><span class="id" type="var">btree</span></span></h2>

 
</div>
<div class="code">
<span class="id" type="keyword">Section</span> <span class="id" type="var">EqBtree</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> (<span class="id" type="var">T</span>: <span class="id" type="var">eqType</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">t</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">eqbtree</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| #, # =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">tl1</span> -&lt; <span class="id" type="var">x1</span> &gt;- <span class="id" type="var">tr1</span>, <span class="id" type="var">tl2</span> -&lt; <span class="id" type="var">x2</span> &gt;- <span class="id" type="var">tr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; (<span class="id" type="var">x1</span> == <span class="id" type="var">x2</span>) &amp;&amp; (<span class="id" type="var">eqbtree</span> <span class="id" type="var">tl1</span> <span class="id" type="var">tl2</span>) &amp;&amp; (<span class="id" type="var">eqbtree</span> <span class="id" type="var">tr1</span> <span class="id" type="var">tr2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eqbtreeP</span>: <span class="id" type="var">Equality.axiom</span> <span class="id" type="var">eqbtree</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Canonical</span> <span class="id" type="var">btree_eqMixin</span> := <span class="id" type="var">EqMixin</span> <span class="id" type="var">eqbtreeP</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Canonical</span> <span class="id" type="var">btree_eqType</span> := <span class="id" type="keyword">Eval</span> <span class="id" type="tactic">hnf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">EqType</span> (<span class="id" type="var">btree</span> <span class="id" type="var">T</span>) <span class="id" type="var">btree_eqMixin</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eqbtreeE</span>: <span class="id" type="var">eqbtree</span> = <span class="id" type="var">eq_op</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eqbtree_btnode</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">tl1</span> <span class="id" type="var">tl2</span> <span class="id" type="var">tr1</span> <span class="id" type="var">tr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tl1</span> -&lt; <span class="id" type="var">x1</span> &gt;- <span class="id" type="var">tr1</span>) == (<span class="id" type="var">tl2</span> -&lt; <span class="id" type="var">x2</span> &gt;- <span class="id" type="var">tr2</span>) = (<span class="id" type="var">x1</span> == <span class="id" type="var">x2</span>) &amp;&amp; (<span class="id" type="var">tl1</span> == <span class="id" type="var">tl2</span>) &amp;&amp; (<span class="id" type="var">tr1</span> == <span class="id" type="var">tr2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">mem_btree</span> (<span class="id" type="var">t</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span>): <span class="id" type="var">pred</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">xpredU1</span> <span class="id" type="var">x</span> (<span class="id" type="var">xpredU</span> (<span class="id" type="var">mem_btree</span> <span class="id" type="var">tl</span>) (<span class="id" type="var">mem_btree</span> <span class="id" type="var">tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">xpred0</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">eqbtree_class</span> := <span class="id" type="var">btree</span> <span class="id" type="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Identity</span> <span class="id" type="keyword">Coercion</span> <span class="id" type="var">btree_of_eqbtree</span>: <span class="id" type="var">eqbtree_class</span> &gt;-&gt; <span class="id" type="var">btree</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Coercion</span> <span class="id" type="var">pred_of_eq_btree</span> (<span class="id" type="var">t</span> : <span class="id" type="var">eqbtree_class</span>) : <span class="id" type="var">pred_class</span> := [<span class="id" type="var">eta</span> <span class="id" type="var">mem_btree</span> <span class="id" type="var">t</span>].<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Canonical</span> <span class="id" type="var">btree_predType</span> := @<span class="id" type="var">mkPredType</span> <span class="id" type="var">T</span> (<span class="id" type="var">btree</span> <span class="id" type="var">T</span>) <span class="id" type="var">pred_of_eq_btree</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Canonical</span> <span class="id" type="var">mem_btree_predType</span> := <span class="id" type="var">mkPredType</span> <span class="id" type="var">mem_btree</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_bnode</span> <span class="id" type="var">a</span> <span class="id" type="var">x</span> <span class="id" type="var">tl</span> <span class="id" type="var">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span>) = (<span class="id" type="var">a</span> == <span class="id" type="var">x</span>) || (<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">tl</span>) || (<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">tr</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_bleaf</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> #) = <span class="id" type="var">false</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_bnode1</span> <span class="id" type="var">a</span> <span class="id" type="var">x</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> #-&lt; <span class="id" type="var">x</span> &gt;-#) = (<span class="id" type="var">a</span> == <span class="id" type="var">x</span>).<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Let</span> <span class="id" type="var">inE</span> := (<span class="id" type="var">mem_bnode1</span>, <span class="id" type="var">in_bnode</span>, <span class="id" type="var">inE</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_root</span> <span class="id" type="var">x</span> <span class="id" type="var">tl</span> <span class="id" type="var">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Section</span> <span class="id" type="var">Preds</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> (<span class="id" type="var">p</span>: <span class="id" type="var">pred</span> <span class="id" type="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">hasP</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="var">exists2</span> <span class="id" type="var">x</span>, <span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span> &amp; <span class="id" type="var">p</span> <span class="id" type="var">x</span>) (<span class="id" type="var">has</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">hasPn</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span> -&gt; ~~ <span class="id" type="var">p</span> <span class="id" type="var">x</span>) (~~ <span class="id" type="var">has</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">allP</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">x</span>) (<span class="id" type="var">all</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">allPn</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="var">exists2</span> <span class="id" type="var">x</span>, <span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span> &amp; ~~ <span class="id" type="var">p</span> <span class="id" type="var">x</span>) (~~ <span class="id" type="var">all</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">End</span> <span class="id" type="var">Preds</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Section</span> <span class="id" type="var">EqIn</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Variables</span> (<span class="id" type="var">p1</span> <span class="id" type="var">p2</span>: <span class="id" type="var">pred</span> <span class="id" type="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_in_count</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>, <span class="id" type="var">p1</span> =1 <span class="id" type="var">p2</span> } -&gt; <span class="id" type="var">count</span> <span class="id" type="var">p1</span> <span class="id" type="var">t</span> = <span class="id" type="var">count</span> <span class="id" type="var">p2</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_in_all</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>, <span class="id" type="var">p1</span> =1 <span class="id" type="var">p2</span> } -&gt; <span class="id" type="var">all</span> <span class="id" type="var">p1</span> <span class="id" type="var">t</span> = <span class="id" type="var">all</span> <span class="id" type="var">p2</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_in_has</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>, <span class="id" type="var">p1</span> =1 <span class="id" type="var">p2</span> } -&gt; <span class="id" type="var">has</span> <span class="id" type="var">p1</span> <span class="id" type="var">t</span> = <span class="id" type="var">has</span> <span class="id" type="var">p2</span> <span class="id" type="var">t</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">sub_all</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">subpred</span> <span class="id" type="var">p1</span> <span class="id" type="var">p2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">all</span> <span class="id" type="var">p1</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">all</span> <span class="id" type="var">p2</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">End</span> <span class="id" type="var">EqIn</span>.<br/>

<br/>

<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_has_r</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t1</span> =<span class="id" type="var">i</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">has</span>^~ <span class="id" type="var">t1</span> =1 <span class="id" type="var">has</span>^~ <span class="id" type="var">t2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_all_r</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t1</span> =<span class="id" type="var">i</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">all</span>^~ <span class="id" type="var">t1</span> =1 <span class="id" type="var">all</span>^~ <span class="id" type="var">t2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">has_sym</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">has</span> (<span class="id" type="var">mem</span> <span class="id" type="var">t1</span>) <span class="id" type="var">t2</span> = <span class="id" type="var">has</span> (<span class="id" type="var">mem</span> <span class="id" type="var">t2</span>) <span class="id" type="var">t1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">has_pred1</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">has</span> (<span class="id" type="var">pred1</span> <span class="id" type="var">x</span>) <span class="id" type="var">t</span> = (<span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_revtree</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">revtree</span> <span class="id" type="var">t</span> =<span class="id" type="var">i</span> <span class="id" type="var">t</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> <span class="id" type="var">count_mem</span> <span class="id" type="var">x</span> := (<span class="id" type="var">count</span> (<span class="id" type="var">pred1</span> <span class="id" type="var">x</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">count_memPn</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">reflect</span> (<span class="id" type="var">count_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> = 0) (<span class="id" type="var">a</span> \<span class="id" type="var">notin</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_flatten</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>) = (<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">flatten</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bleaf_flatten_nil</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">t</span> == #) = (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span> == [::]).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">uniq</span> <span class="id" type="var">t</span>: <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> (<span class="id" type="var">x</span> \<span class="id" type="var">notin</span> <span class="id" type="var">tl</span>) &amp;&amp; (<span class="id" type="var">uniq</span> <span class="id" type="var">tl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; (<span class="id" type="var">x</span> \<span class="id" type="var">notin</span> <span class="id" type="var">tr</span>) &amp;&amp; (<span class="id" type="var">uniq</span> <span class="id" type="var">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; (<span class="id" type="var">all</span> (<span class="id" type="var">negb</span> \<span class="id" type="var">o</span> <span class="id" type="var">mem</span> <span class="id" type="var">tr</span>) <span class="id" type="var">tl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; (<span class="id" type="var">all</span> (<span class="id" type="var">negb</span> \<span class="id" type="var">o</span> <span class="id" type="var">mem</span> <span class="id" type="var">tl</span>) <span class="id" type="var">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">true</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">count_uniq_mem</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">uniq</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">count_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> = (<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">app_fst</span> {<span class="id" type="var">A</span> <span class="id" type="var">A'</span> <span class="id" type="var">B</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">f</span>: <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A'</span>)(<span class="id" type="var">p</span>: <span class="id" type="var">A</span> * <span class="id" type="var">B</span>) := (<span class="id" type="var">f</span> <span class="id" type="var">p</span>.1, <span class="id" type="var">p</span>.2).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> "f ^1 p" := (<span class="id" type="var">app_fst</span> <span class="id" type="var">f</span> <span class="id" type="var">p</span>) (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 3, <span class="id" type="tactic">left</span> <span class="id" type="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">app_snd</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">B'</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">f</span>: <span class="id" type="var">B</span> -&gt; <span class="id" type="var">B'</span>)(<span class="id" type="var">p</span>: <span class="id" type="var">A</span> * <span class="id" type="var">B</span>) := (<span class="id" type="var">p</span>.1, <span class="id" type="var">f</span> <span class="id" type="var">p</span>.2).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> "f ^2 p" := (<span class="id" type="var">app_snd</span> <span class="id" type="var">f</span> <span class="id" type="var">p</span>) (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 3, <span class="id" type="tactic">left</span> <span class="id" type="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>: <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">lend</span> <span class="id" type="var">x</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">a</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>: <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">rend</span> <span class="id" type="var">tr</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">a</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_rev_rend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> = <span class="id" type="var">rend</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) <span class="id" type="var">a</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> == <span class="id" type="var">a</span>) || (<span class="id" type="var">lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span> == <span class="id" type="var">a</span>) || (<span class="id" type="var">rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Type</span> (<span class="id" type="var">s</span>: <span class="id" type="var">seq</span> <span class="id" type="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> <span class="id" type="var">rhead</span> <span class="id" type="var">s</span> <span class="id" type="var">a</span> := (<span class="id" type="var">last</span> <span class="id" type="var">a</span> <span class="id" type="var">s</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">rbehead</span> <span class="id" type="var">s</span>: <span class="id" type="var">seq</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">s</span> <span class="id" type="var">is</span> <span class="id" type="var">x</span> :: <span class="id" type="var">s'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">if</span> <span class="id" type="var">s'</span> <span class="id" type="var">is</span> [::] <span class="id" type="keyword">then</span> [::]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">x</span> :: <span class="id" type="var">rbehead</span> <span class="id" type="var">s'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> [::].<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rbehead_cons</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rbehead</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">y</span> :: <span class="id" type="var">s</span>) = <span class="id" type="var">x</span> :: (<span class="id" type="var">rbehead</span> (<span class="id" type="var">y</span> :: <span class="id" type="var">s</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rbehead_cat_cons</span> <span class="id" type="var">s1</span> <span class="id" type="var">x</span> <span class="id" type="var">s2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rbehead</span> (<span class="id" type="var">s1</span> ++ <span class="id" type="var">x</span> :: <span class="id" type="var">s2</span>) = <span class="id" type="var">s1</span> ++ <span class="id" type="var">rbehead</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">s2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_rbehead</span> <span class="id" type="var">a</span> <span class="id" type="var">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> (<span class="id" type="var">rbehead</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">a</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">s</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">head_cat_cons</span> <span class="id" type="var">a</span> <span class="id" type="var">x</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">head</span> <span class="id" type="var">a</span> (<span class="id" type="var">s1</span> ++ <span class="id" type="var">x</span> :: <span class="id" type="var">s2</span>) = <span class="id" type="var">head</span> <span class="id" type="var">a</span> (<span class="id" type="var">rcons</span> <span class="id" type="var">s1</span> <span class="id" type="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_flatten_head</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> = <span class="id" type="var">head</span> <span class="id" type="var">a</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rend_flatten_rhead</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span> =  <span class="id" type="var">rhead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) <span class="id" type="var">a</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>: <span class="id" type="var">T</span> * <span class="id" type="var">btree</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">if</span> <span class="id" type="var">tl</span> <span class="id" type="var">is</span> # <span class="id" type="keyword">then</span> (<span class="id" type="var">x</span>, <span class="id" type="var">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">node</span>, <span class="id" type="var">t'</span>) := <span class="id" type="var">lend_remove</span> <span class="id" type="var">x</span> <span class="id" type="var">tl</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">node</span> , <span class="id" type="var">t'</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> (<span class="id" type="var">a</span>, #).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span> * <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">if</span> <span class="id" type="var">tr</span> <span class="id" type="var">is</span> # <span class="id" type="keyword">then</span> (<span class="id" type="var">tl</span>, <span class="id" type="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">t'</span>, <span class="id" type="var">node</span>) := <span class="id" type="var">rend_remove</span> <span class="id" type="var">tr</span> <span class="id" type="var">x</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">t'</span>, <span class="id" type="var">node</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> (#, <span class="id" type="var">a</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">swap</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">p</span>: <span class="id" type="var">A</span> * <span class="id" type="var">B</span>): <span class="id" type="var">B</span> * <span class="id" type="var">A</span> := (<span class="id" type="var">p</span>.2,<span class="id" type="var">p</span>.1).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">swap_involutive</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">p</span>: <span class="id" type="var">A</span> * <span class="id" type="var">B</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">swap</span> (<span class="id" type="var">swap</span> <span class="id" type="var">p</span>) = <span class="id" type="var">p</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">swap_flip</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">p</span>: <span class="id" type="var">A</span> * <span class="id" type="var">B</span>) <span class="id" type="var">q</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> = <span class="id" type="var">swap</span> <span class="id" type="var">q</span> -&gt; <span class="id" type="var">swap</span> <span class="id" type="var">p</span> = <span class="id" type="var">q</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">swap_app_fst</span> {<span class="id" type="var">A</span> <span class="id" type="var">A'</span> <span class="id" type="var">B</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">f</span>: <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A'</span>)(<span class="id" type="var">p</span>: <span class="id" type="var">A</span>*<span class="id" type="var">B</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">swap</span> (<span class="id" type="var">f</span> ^1 <span class="id" type="var">p</span>) = <span class="id" type="var">f</span> ^2 (<span class="id" type="var">swap</span> <span class="id" type="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">swap_app_snd</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">B'</span>: <span class="id" type="keyword">Type</span>}(<span class="id" type="var">f</span>: <span class="id" type="var">B</span> -&gt; <span class="id" type="var">B'</span>)(<span class="id" type="var">p</span>: <span class="id" type="var">A</span>*<span class="id" type="var">B</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">swap</span> (<span class="id" type="var">f</span> ^2 <span class="id" type="var">p</span>) = <span class="id" type="var">f</span> ^1 (<span class="id" type="var">swap</span> <span class="id" type="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_remove_revtree</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) = <span class="id" type="var">swap</span> (<span class="id" type="var">revtree</span>^1 (<span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rend_remove_revtree</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rend_remove</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) <span class="id" type="var">a</span> = <span class="id" type="var">swap</span> (<span class="id" type="var">revtree</span>^2 (<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_remove_lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>).1 = <span class="id" type="var">lend</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rend_remove_rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>).2 = <span class="id" type="var">rend</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_remove_behead</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">flatten</span> (<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>).2 = <span class="id" type="var">behead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_remove_head</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>).1 = <span class="id" type="var">head</span> <span class="id" type="var">a</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_remove_head_behead</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">flatten</span>^2 (<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>) = (<span class="id" type="var">head</span> <span class="id" type="var">a</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>), <span class="id" type="var">behead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rend_remove_rhead</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>).2 = <span class="id" type="var">rhead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) <span class="id" type="var">a</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rend_remove_rbehead</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">flatten</span> (<span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>).1 = <span class="id" type="var">rbehead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rend_remove_rhead_rbehead</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">flatten</span>^1 (<span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>) = (<span class="id" type="var">rbehead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>),<span class="id" type="var">rhead</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">t</span>) <span class="id" type="var">a</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_lend_remove</span> <span class="id" type="var">x</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> (<span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span>).2 -&gt; <span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_rend_remove</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> (<span class="id" type="var">rend_remove</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>).1 -&gt; <span class="id" type="var">x</span> \<span class="id" type="keyword">in</span> <span class="id" type="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">rem_root_l</span> <span class="id" type="var">t</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">node</span>, <span class="id" type="var">tr'</span>) := <span class="id" type="var">lend_remove</span> <span class="id" type="var">x</span> <span class="id" type="var">tr</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tl</span> -&lt; <span class="id" type="var">node</span> &gt;- <span class="id" type="var">tr'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> #.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">rem_root_r</span> <span class="id" type="var">t</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">t</span> <span class="id" type="var">is</span> <span class="id" type="var">tl</span> -&lt; <span class="id" type="var">x</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">tl'</span>, <span class="id" type="var">node</span>) := <span class="id" type="var">rend_remove</span> <span class="id" type="var">tl</span> <span class="id" type="var">x</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tl'</span> -&lt; <span class="id" type="var">node</span> &gt;- <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> #.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rem_root_l_revtree</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rem_root_l</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) = <span class="id" type="var">revtree</span> (<span class="id" type="var">rem_root_r</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rem_root_r_revtree</span> <span class="id" type="var">t</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rem_root_r</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">t</span>) = <span class="id" type="var">revtree</span> (<span class="id" type="var">rem_root_l</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">lend_merge</span> <span class="id" type="var">a</span> <span class="id" type="var">tl</span> <span class="id" type="var">tr</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">tr</span> <span class="id" type="var">is</span> # <span class="id" type="keyword">then</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">node</span>, <span class="id" type="var">tr'</span>) := <span class="id" type="var">lend_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">tr</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tl</span> -&lt; <span class="id" type="var">node</span> &gt;- <span class="id" type="var">tr'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">rend_merge</span> <span class="id" type="var">tl</span> <span class="id" type="var">tr</span> <span class="id" type="var">a</span>: <span class="id" type="var">btree</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">tl</span> <span class="id" type="var">is</span> # <span class="id" type="keyword">then</span> <span class="id" type="var">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">tl'</span>, <span class="id" type="var">node</span>) := <span class="id" type="var">rend_remove</span> <span class="id" type="var">tl</span> <span class="id" type="var">a</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tl'</span> -&lt; <span class="id" type="var">node</span> &gt;- <span class="id" type="var">tr</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lend_merge_revtree</span> <span class="id" type="var">a</span> <span class="id" type="var">tl</span> <span class="id" type="var">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">lend_merge</span> <span class="id" type="var">a</span> (<span class="id" type="var">revtree</span> <span class="id" type="var">tl</span>) (<span class="id" type="var">revtree</span> <span class="id" type="var">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" type="var">revtree</span> (<span class="id" type="var">rend_merge</span> <span class="id" type="var">tr</span> <span class="id" type="var">tl</span> <span class="id" type="var">a</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">EqBtree</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">inE</span> := (<span class="id" type="var">mem_bnode1</span>, <span class="id" type="var">in_bnode</span>, <span class="id" type="var">inE</span>).<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>